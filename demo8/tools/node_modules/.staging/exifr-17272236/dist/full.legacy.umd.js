!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define("exifr",["exports"],t):t((e=e||self).exifr={})}(this,(function(e){"use strict";function t(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function r(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}});var n=["prototype","__proto__","caller","arguments","length","name"];Object.getOwnPropertyNames(t).forEach((function(r){-1===n.indexOf(r)&&e[r]!==t[r]&&(e[r]=t[r])})),t&&s(e,t)}function o(e){return(o=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function s(e,t){return(s=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function u(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function f(e,t,n){return(f=u()?Reflect.construct:function(e,t,n){var r=[null];r.push.apply(r,t);var i=new(Function.bind.apply(e,r));return n&&s(i,n.prototype),i}).apply(null,arguments)}function l(e){var t="function"==typeof Map?new Map:void 0;return(l=function(e){if(null===e||(n=e,-1===Function.toString.call(n).indexOf("[native code]")))return e;var n;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,r)}function r(){return f(e,arguments,o(this).constructor)}return r.prototype=Object.create(e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),s(r,e)})(e)}function c(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function h(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?c(e):t}function d(e,t,n){return(d="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=o(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}var p=Object.values||function(e){var t=[];for(var n in e)t.push(e[n]);return t},g=Object.entries||function(e){var t=[];for(var n in e)t.push([n,e[n]]);return t},v=Object.assign||function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return n.forEach((function(t){for(var n in t)e[n]=t[n]})),e},y=Object.fromEntries||function(e){var t={};return m(e).forEach((function(e){var n=e[0],r=e[1];t[n]=r})),t},m=Array.from||function(e){if(e instanceof A){var t=[];return e.forEach((function(e,n){return t.push([n,e])})),t}return Array.prototype.slice.call(e)};function k(e){return-1!==this.indexOf(e)}Array.prototype.includes||(Array.prototype.includes=k),String.prototype.includes||(String.prototype.includes=k),String.prototype.startsWith||(String.prototype.startsWith=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.substring(t,t+e.length)===e}),String.prototype.endsWith||(String.prototype.endsWith=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.length;return this.substring(t-e.length,t)===e});var S="undefined"!=typeof self?self:global,C=S.fetch||function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new Promise((function(n,r){var i=new XMLHttpRequest;if(i.open("get",e,!0),i.responseType="arraybuffer",i.onerror=r,t.headers)for(var a in t.headers)i.setRequestHeader(a,t.headers[a]);i.onload=function(){n({ok:i.status>=200&&i.status<300,status:i.status,arrayBuffer:function(){return Promise.resolve(i.response)}})},i.send(null)}))},b=function(e){var t=[];if(Object.defineProperties(t,{size:{get:function(){return this.length}},has:{value:function(e){return-1!==this.indexOf(e)}},add:{value:function(e){this.has(e)||this.push(e)}},delete:{value:function(e){if(this.has(e)){var t=this.indexOf(e);this.splice(t,1)}}}}),Array.isArray(e))for(var n=0;n<e.length;n++)t.add(e[n]);return t},P=function(e){return new A(e)},A=void 0!==S.Map&&void 0!==S.Map.prototype.keys?S.Map:function(){function e(n){if(t(this,e),this.clear(),n)for(var r=0;r<n.length;r++)this.set(n[r][0],n[r][1])}return r(e,[{key:"clear",value:function(){this._map={},this._keys=[]}},{key:"get",value:function(e){return this._map["map_"+e]}},{key:"set",value:function(e,t){return this._map["map_"+e]=t,this._keys.indexOf(e)<0&&this._keys.push(e),this}},{key:"has",value:function(e){return this._keys.indexOf(e)>=0}},{key:"delete",value:function(e){var t=this._keys.indexOf(e);return!(t<0)&&(delete this._map["map_"+e],this._keys.splice(t,1),!0)}},{key:"keys",value:function(){return this._keys.slice(0)}},{key:"values",value:function(){var e=this;return this._keys.map((function(t){return e.get(t)}))}},{key:"entries",value:function(){var e=this;return this._keys.map((function(t){return[t,e.get(t)]}))}},{key:"forEach",value:function(e,t){for(var n=0;n<this._keys.length;n++)e.call(t,this._map["map_"+this._keys[n]],this._keys[n],this)}},{key:"size",get:function(){return this._keys.length}}]),e}(),I="undefined"!=typeof self?self:global,T="undefined"!=typeof navigator,O=T&&"undefined"==typeof HTMLImageElement,D=!("undefined"==typeof global||"undefined"==typeof process||!process.versions||!process.versions.node),w=I.Buffer,x=I.BigInt,R=!!w;function M(e){return F(e)?void 0:e}var L=function(e){return void 0!==e};function F(e){return void 0===e||(e instanceof A?0===e.size:0===p(e).filter(L).length)}function U(e){var t=new Error(e);return delete t.stack,t}function B(e){return""===(e=function(e){for(;e.endsWith("\0");)e=e.slice(0,-1);return e}(e).trim())?void 0:e}function E(e){var t=function(e){var t=0;return e.ifd0.enabled&&(t+=1024),e.exif.enabled&&(t+=2048),e.makerNote&&(t+=2048),e.userComment&&(t+=1024),e.gps.enabled&&(t+=512),e.interop.enabled&&(t+=100),e.ifd1.enabled&&(t+=1024),t+2048}(e);return e.jfif.enabled&&(t+=50),e.xmp.enabled&&(t+=2e4),e.iptc.enabled&&(t+=14e3),e.icc.enabled&&(t+=6e3),t}var N="undefined"!=typeof TextDecoder?new TextDecoder("utf-8"):void 0;function G(e){return N?N.decode(e):R?Buffer.from(e).toString("utf8"):decodeURIComponent(escape(String.fromCharCode.apply(null,e)))}var V=function(){function e(n){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2?arguments[2]:void 0,a=arguments.length>3?arguments[3]:void 0;if(t(this,e),"boolean"==typeof a&&(this.le=a),Array.isArray(n)&&(n=new Uint8Array(n)),0===n)this.byteOffset=0,this.byteLength=0;else if(n instanceof ArrayBuffer){void 0===i&&(i=n.byteLength-r);var o=new DataView(n,r,i);this._swapDataView(o)}else if(n instanceof Uint8Array||n instanceof DataView||n instanceof e){if(void 0===i&&(i=n.byteLength-r),(r+=n.byteOffset)+i>n.byteOffset+n.byteLength)throw U("Creating view outside of available memory in ArrayBuffer");var s=new DataView(n.buffer,r,i);this._swapDataView(s)}else{if("number"!=typeof n)throw U("Invalid input argument for BufferView: "+n);var u=new DataView(new ArrayBuffer(n));this._swapDataView(u)}}return r(e,null,[{key:"from",value:function(t,n){return t instanceof this&&t.le===n?t:new e(t,void 0,void 0,n)}}]),r(e,[{key:"_swapArrayBuffer",value:function(e){this._swapDataView(new DataView(e))}},{key:"_swapBuffer",value:function(e){this._swapDataView(new DataView(e.buffer,e.byteOffset,e.byteLength))}},{key:"_swapDataView",value:function(e){this.dataView=e,this.buffer=e.buffer,this.byteOffset=e.byteOffset,this.byteLength=e.byteLength}},{key:"_lengthToEnd",value:function(e){return this.byteLength-e}},{key:"set",value:function(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e;if(t instanceof DataView||t instanceof e?t=new Uint8Array(t.buffer,t.byteOffset,t.byteLength):t instanceof ArrayBuffer&&(t=new Uint8Array(t)),!(t instanceof Uint8Array))throw U("BufferView.set(): Invalid data argument.");var i=this.toUint8();return i.set(t,n),new r(this,n,t.byteLength)}},{key:"subarray",value:function(t,n){return new e(this,t,n=n||this._lengthToEnd(t))}},{key:"toUint8",value:function(){return new Uint8Array(this.buffer,this.byteOffset,this.byteLength)}},{key:"getUint8Array",value:function(e,t){return new Uint8Array(this.buffer,this.byteOffset+e,t)}},{key:"getString",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.byteLength,n=this.getUint8Array(e,t);return G(n)}},{key:"getUnicodeString",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.byteLength,n=[],r=0;r<t&&e+r<this.byteLength;r+=2)n.push(this.getUint16(e+r));return n.map((function(e){return String.fromCharCode(e)})).join("")}},{key:"getInt8",value:function(e){return this.dataView.getInt8(e)}},{key:"getUint8",value:function(e){return this.dataView.getUint8(e)}},{key:"getInt16",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.le;return this.dataView.getInt16(e,t)}},{key:"getInt32",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.le;return this.dataView.getInt32(e,t)}},{key:"getUint16",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.le;return this.dataView.getUint16(e,t)}},{key:"getUint32",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.le;return this.dataView.getUint32(e,t)}},{key:"getFloat32",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.le;return this.dataView.getFloat32(e,t)}},{key:"getFloat64",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.le;return this.dataView.getFloat64(e,t)}},{key:"getFloat",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.le;return this.dataView.getFloat32(e,t)}},{key:"getDouble",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.le;return this.dataView.getFloat64(e,t)}},{key:"getUint64",value:function(e){var t=this.getUint32(e),n=this.getUint32(e+4);if(t<1048575)return t<<32|n;if(void 0!==typeof x)return console.warn("Using BigInt because of type 64uint but JS can only handle 53b numbers."),x(t)<<x(32)|x(n);throw U("Trying to read 64b value but JS can only handle 53b numbers.")}},{key:"getUintBytes",value:function(e,t,n){switch(t){case 1:return this.getUint8(e,n);case 2:return this.getUint16(e,n);case 4:return this.getUint32(e,n);case 8:return this.getUint64(e,n)}}},{key:"getUint",value:function(e,t,n){switch(t){case 8:return this.getUint8(e,n);case 16:return this.getUint16(e,n);case 32:return this.getUint32(e,n);case 64:return this.getUint64(e,n)}}},{key:"toString",value:function(e){return this.dataView.toString(e,this.constructor.name)}},{key:"ensureChunk",value:function(){}}]),e}();function j(e,t){throw U("".concat(e," '").concat(t,"' was not loaded, try using full build of exifr."))}var z=function(e){function n(e){var r;return t(this,n),(r=h(this,o(n).call(this))).kind=e,r}return a(n,e),r(n,[{key:"get",value:function(e,t){return this.has(e)||j(this.kind,e),t&&(e in t||function(e,t){throw U("Unknown ".concat(e," '").concat(t,"'."))}(this.kind,e),t[e].enabled||j(this.kind,e)),d(o(n.prototype),"get",this).call(this,e)}},{key:"keyList",value:function(){return m(this.keys())}}]),n}(l(A)),H=new z("file parser"),_=new z("segment parser"),W=new z("file reader");function K(e){return function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];try{return Promise.resolve(e.apply(this,t))}catch(e){return Promise.reject(e)}}}function X(e,t,n){return n?t?t(e):e:(e&&e.then||(e=Promise.resolve(e)),t?e.then(t):e)}var J=K((function(e){return new Promise((function(t,n){var r=new FileReader;r.onloadend=function(){return t(r.result||new ArrayBuffer)},r.onerror=n,r.readAsArrayBuffer(e)}))})),Y=K((function(e){return C(e).then((function(e){return e.arrayBuffer()}))})),q=K((function(e,t){return X(t(e),(function(e){return new V(e)}))})),Q=K((function(e,t,n){var r=new(W.get(n))(e,t);return X(r.read(),(function(){return r}))})),Z=K((function(e,t,n,r){if(W.has(n))return Q(e,t,n);if(r)return q(e,r);throw U("Parser ".concat(n," is not loaded"))}));function $(e,t){if((n=e).startsWith("data:")||n.length>1e4)return Q(e,t,"base64");if(T)return Z(e,t,"url",Y);if(D)return Q(e,t,"fs");throw U("Invalid input argument");var n}var ee=function(e){function n(){return t(this,n),h(this,o(n).apply(this,arguments))}return a(n,e),r(n,[{key:"tagKeys",get:function(){return this.allKeys||(this.allKeys=m(this.keys())),this.allKeys}},{key:"tagValues",get:function(){return this.allValues||(this.allValues=m(this.values())),this.allValues}}]),n}(l(A));function te(e,t,n){var r=new ee,i=n;Array.isArray(i)||("function"==typeof i.entries&&(i=i.entries()),i=m(i));for(var a=0;a<i.length;a++){var o=i[a],s=o[0],u=o[1];r.set(s,u)}if(Array.isArray(t)){var f=t;Array.isArray(f)||("function"==typeof f.entries&&(f=f.entries()),f=m(f));for(var l=0;l<f.length;l++){var c=f[l];e.set(c,r)}}else e.set(t,r);return r}function ne(e,t,n){var r,i=e.get(t),a=n;Array.isArray(a)||("function"==typeof a.entries&&(a=a.entries()),a=m(a));for(var o=0;o<a.length;o++)r=a[o],i.set(r[0],r[1])}var re=P(),ie=P(),ae=P(),oe=["chunked","firstChunkSize","firstChunkSizeNode","firstChunkSizeBrowser","chunkSize","chunkLimit"],se=["jfif","xmp","icc","iptc"],ue=["tiff"].concat(se),fe=["ifd0","ifd1","exif","gps","interop"],le=[].concat(ue,fe),ce=["makerNote","userComment"],he=["translateKeys","translateValues","reviveValues","multiSegment"],de=[].concat(he,["sanitize","mergeOutput"]),pe=function(){function e(){t(this,e)}return r(e,[{key:"translate",get:function(){return this.translateKeys||this.translateValues||this.reviveValues}}]),e}(),ge=function(e){function n(e,r,a,s){var u;if(t(this,n),i(c(u=h(this,o(n).call(this))),"enabled",!1),i(c(u),"skip",b()),i(c(u),"pick",b()),i(c(u),"deps",b()),i(c(u),"translateKeys",!1),i(c(u),"translateValues",!1),i(c(u),"reviveValues",!1),u.key=e,u.enabled=r,u.parse=u.enabled,u.applyInheritables(s),u.canBeFiltered=fe.includes(e),u.canBeFiltered&&(u.dict=re.get(e)),void 0!==a)if(Array.isArray(a))u.parse=u.enabled=!0,u.canBeFiltered&&a.length>0&&u.translateTagSet(a,u.pick);else if("object"==typeof a){if(u.enabled=!0,u.parse=!1!==a.parse,u.canBeFiltered){var f=a.pick,l=a.skip;f&&f.length>0&&u.translateTagSet(f,u.pick),l&&l.length>0&&u.translateTagSet(l,u.skip)}u.applyInheritables(a)}else{if(!0!==a&&!1!==a)throw U("Invalid options argument: ".concat(a));u.parse=u.enabled=a}return u}return a(n,e),r(n,[{key:"needed",get:function(){return this.enabled||this.deps.size>0}}]),r(n,[{key:"applyInheritables",value:function(e){var t,n,r=he;Array.isArray(r)||("function"==typeof r.entries&&(r=r.entries()),r=m(r));for(var i=0;i<r.length;i++)void 0!==(n=e[t=r[i]])&&(this[t]=n)}},{key:"translateTagSet",value:function(e,t){if(this.dict){var n,r,i=this.dict,a=i.tagKeys,o=i.tagValues,s=e;Array.isArray(s)||("function"==typeof s.entries&&(s=s.entries()),s=m(s));for(var u=0;u<s.length;u++)"string"==typeof(n=s[u])?(-1===(r=o.indexOf(n))&&(r=a.indexOf(Number(n))),-1!==r&&t.add(Number(a[r]))):t.add(n)}else{var f=e;Array.isArray(f)||("function"==typeof f.entries&&(f=f.entries()),f=m(f));for(var l=0;l<f.length;l++){var c=f[l];t.add(c)}}}},{key:"finalizeFilters",value:function(){!this.enabled&&this.deps.size>0?(this.enabled=!0,Ce(this.pick,this.deps)):this.enabled&&this.pick.size>0&&Ce(this.pick,this.deps)}}]),n}(pe),ve={jfif:!1,tiff:!0,xmp:!1,icc:!1,iptc:!1,ifd0:!0,ifd1:!1,exif:!0,gps:!0,interop:!1,makerNote:!1,userComment:!1,multiSegment:!1,skip:[],pick:[],translateKeys:!0,translateValues:!0,reviveValues:!0,sanitize:!0,mergeOutput:!0,silentErrors:!0,chunked:!0,firstChunkSize:void 0,firstChunkSizeNode:512,firstChunkSizeBrowser:65536,chunkSize:65536,chunkLimit:5},ye=P(),me=function(e){function n(e){var r;if(t(this,n),r=h(this,o(n).call(this)),!0===e)r.setupFromTrue();else if(void 0===e)r.setupFromUndefined();else if(Array.isArray(e))r.setupFromArray(e);else{if("object"!=typeof e)throw U("Invalid options argument ".concat(e));r.setupFromObject(e)}return void 0===r.firstChunkSize&&(r.firstChunkSize=T?r.firstChunkSizeBrowser:r.firstChunkSizeNode),r.mergeOutput&&(r.ifd1.enabled=!1),r.filterNestedSegmentTags(),r.traverseTiffDependencyTree(),r.checkLoadedPlugins(),r}return a(n,e),r(n,null,[{key:"useCached",value:function(e){var t=ye.get(e);return void 0!==t?t:(t=new this(e),ye.set(e,t),t)}}]),r(n,[{key:"setupFromUndefined",value:function(){var e,t=oe;Array.isArray(t)||("function"==typeof t.entries&&(t=t.entries()),t=m(t));for(var n=0;n<t.length;n++)this[e=t[n]]=ve[e];var r=de;Array.isArray(r)||("function"==typeof r.entries&&(r=r.entries()),r=m(r));for(var i=0;i<r.length;i++)this[e=r[i]]=ve[e];var a=ce;Array.isArray(a)||("function"==typeof a.entries&&(a=a.entries()),a=m(a));for(var o=0;o<a.length;o++)this[e=a[o]]=ve[e];var s=le;Array.isArray(s)||("function"==typeof s.entries&&(s=s.entries()),s=m(s));for(var u=0;u<s.length;u++)this[e=s[u]]=new ge(e,ve[e],void 0,this)}},{key:"setupFromTrue",value:function(){var e,t=oe;Array.isArray(t)||("function"==typeof t.entries&&(t=t.entries()),t=m(t));for(var n=0;n<t.length;n++)this[e=t[n]]=ve[e];var r=de;Array.isArray(r)||("function"==typeof r.entries&&(r=r.entries()),r=m(r));for(var i=0;i<r.length;i++)this[e=r[i]]=ve[e];var a=ce;Array.isArray(a)||("function"==typeof a.entries&&(a=a.entries()),a=m(a));for(var o=0;o<a.length;o++)this[e=a[o]]=!0;var s=le;Array.isArray(s)||("function"==typeof s.entries&&(s=s.entries()),s=m(s));for(var u=0;u<s.length;u++)this[e=s[u]]=new ge(e,!0,void 0,this)}},{key:"setupFromArray",value:function(e){var t,n=oe;Array.isArray(n)||("function"==typeof n.entries&&(n=n.entries()),n=m(n));for(var r=0;r<n.length;r++)this[t=n[r]]=ve[t];var i=de;Array.isArray(i)||("function"==typeof i.entries&&(i=i.entries()),i=m(i));for(var a=0;a<i.length;a++)this[t=i[a]]=ve[t];var o=ce;Array.isArray(o)||("function"==typeof o.entries&&(o=o.entries()),o=m(o));for(var s=0;s<o.length;s++)this[t=o[s]]=ve[t];var u=le;Array.isArray(u)||("function"==typeof u.entries&&(u=u.entries()),u=m(u));for(var f=0;f<u.length;f++)this[t=u[f]]=new ge(t,!1,void 0,this);this.setupGlobalFilters(e,void 0,fe)}},{key:"setupFromObject",value:function(e){var t;fe.ifd0=fe.ifd0||fe.image,fe.ifd1=fe.ifd1||fe.thumbnail,v(this,e);var n=oe;Array.isArray(n)||("function"==typeof n.entries&&(n=n.entries()),n=m(n));for(var r=0;r<n.length;r++)this[t=n[r]]=Se(e[t],ve[t]);var i=de;Array.isArray(i)||("function"==typeof i.entries&&(i=i.entries()),i=m(i));for(var a=0;a<i.length;a++)this[t=i[a]]=Se(e[t],ve[t]);var o=ce;Array.isArray(o)||("function"==typeof o.entries&&(o=o.entries()),o=m(o));for(var s=0;s<o.length;s++)this[t=o[s]]=Se(e[t],ve[t]);var u=ue;Array.isArray(u)||("function"==typeof u.entries&&(u=u.entries()),u=m(u));for(var f=0;f<u.length;f++)this[t=u[f]]=new ge(t,ve[t],e[t],this);var l=fe;Array.isArray(l)||("function"==typeof l.entries&&(l=l.entries()),l=m(l));for(var c=0;c<l.length;c++)this[t=l[c]]=new ge(t,ve[t],e[t],this.tiff);this.setupGlobalFilters(e.pick,e.skip,fe,le),!0===e.tiff?this.batchEnableWithBool(fe,!0):!1===e.tiff?this.batchEnableWithUserValue(fe,e):Array.isArray(e.tiff)?this.setupGlobalFilters(e.tiff,void 0,fe):"object"==typeof e.tiff&&this.setupGlobalFilters(e.tiff.pick,e.tiff.skip,fe)}},{key:"batchEnableWithBool",value:function(e,t){var n=e;Array.isArray(n)||("function"==typeof n.entries&&(n=n.entries()),n=m(n));for(var r=0;r<n.length;r++){this[n[r]].enabled=t}}},{key:"batchEnableWithUserValue",value:function(e,t){var n=e;Array.isArray(n)||("function"==typeof n.entries&&(n=n.entries()),n=m(n));for(var r=0;r<n.length;r++){var i=n[r],a=t[i];this[i].enabled=!1!==a&&void 0!==a}}},{key:"setupGlobalFilters",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:n;if(e&&e.length){var i=r;Array.isArray(i)||("function"==typeof i.entries&&(i=i.entries()),i=m(i));for(var a=0;a<i.length;a++){var o=i[a];this[o].enabled=!1}var s=ke(e,n),u=s;Array.isArray(u)||("function"==typeof u.entries&&(u=u.entries()),u=m(u));for(var f=0;f<u.length;f++){var l=u[f],c=l[0],h=l[1];Ce(this[c].pick,h),this[c].enabled=!0}}else if(t&&t.length){var d=ke(t,n),p=d;Array.isArray(p)||("function"==typeof p.entries&&(p=p.entries()),p=m(p));for(var g=0;g<p.length;g++){var v=p[g],y=v[0],k=v[1];Ce(this[y].skip,k)}}}},{key:"filterNestedSegmentTags",value:function(){var e=this.ifd0,t=this.exif,n=this.xmp,r=this.iptc,i=this.icc;this.makerNote?t.deps.add(37500):t.skip.add(37500),this.userComment?t.deps.add(37510):t.skip.add(37510),n.enabled||e.skip.add(700),r.enabled||e.skip.add(33723),i.enabled||e.skip.add(34675)}},{key:"traverseTiffDependencyTree",value:function(){var e=this,t=this.ifd0,n=this.exif,r=this.gps;this.interop.needed&&(n.deps.add(40965),t.deps.add(40965)),n.needed&&t.deps.add(34665),r.needed&&t.deps.add(34853),this.tiff.enabled=fe.some((function(t){return!0===e[t].enabled}))||this.makerNote||this.userComment;var i=fe;Array.isArray(i)||("function"==typeof i.entries&&(i=i.entries()),i=m(i));for(var a=0;a<i.length;a++){this[i[a]].finalizeFilters()}}},{key:"checkLoadedPlugins",value:function(){var e=ue;Array.isArray(e)||("function"==typeof e.entries&&(e=e.entries()),e=m(e));for(var t=0;t<e.length;t++){var n=e[t];this[n].enabled&&!_.has(n)&&j("segment parser",n)}}},{key:"onlyTiff",get:function(){var e=this;return!se.map((function(t){return e[t].enabled})).some((function(e){return!0===e}))&&this.tiff.enabled}}]),n}(pe);function ke(e,t){var n,r,i,a=[],o=t;Array.isArray(o)||("function"==typeof o.entries&&(o=o.entries()),o=m(o));for(var s=0;s<o.length;s++){r=o[s],n=[];var u=re.get(r);Array.isArray(u)||("function"==typeof u.entries&&(u=u.entries()),u=m(u));for(var f=0;f<u.length;f++)i=u[f],(e.includes(i[0])||e.includes(i[1]))&&n.push(i[0]);n.length&&a.push([r,n])}return a}function Se(e,t){return void 0!==e?e:void 0!==t?t:void 0}function Ce(e,t){var n=t;Array.isArray(n)||("function"==typeof n.entries&&(n=n.entries()),n=m(n));for(var r=0;r<n.length;r++){var i=n[r];e.add(i)}}i(me,"default",ve);var be={ifd0:!1,ifd1:!1,exif:!1,gps:!1,interop:!1,sanitize:!1,reviveValues:!0,translateKeys:!1,translateValues:!1,mergeOutput:!1},Pe=v({},be,{firstChunkSize:4e4,gps:[1,2,3,4]}),Ae=v({},be,{firstChunkSize:4e4,ifd0:[274]}),Ie=v({},be,{tiff:!1,ifd1:!0,mergeOutput:!1});function Te(e,t,n){return n?t?t(e):e:(e&&e.then||(e=Promise.resolve(e)),t?e.then(t):e)}function Oe(e,t){var n=e();return n&&n.then?n.then(t):t(n)}function De(){}var we=function(){function e(n){t(this,e),i(this,"parsers",{}),this.options=me.useCached(n)}return r(e,[{key:"setup",value:function(){if(!this.fileParser){var e,t=this.file.getUint16(0);if(18761===t||19789===t)this.file.isTiff=!0,e=H.get("tiff");else if(65496===t)this.file.isJpeg=!0,e=H.get("jpeg");else{if(!function(e){if(0!==e.getUint16(0))return!1;var t=e.getUint16(2);if(t>50)return!1;for(var n=16,r=[];n<t;)r.push(e.getString(n,4)),n+=4;return r.includes("heic")}(this.file))throw U("Unknown file format");this.file.isHeic=!0,e=H.get("heic")}this.fileParser=new e(this.options,this.file,this.parsers)}}},{key:"read",value:function(e){try{var t=this;return Te(function(e,t){if("string"==typeof e)return $(e,t);if(T&&!O&&e instanceof HTMLImageElement)return $(e.src,t);if(e instanceof Uint8Array||e instanceof ArrayBuffer||e instanceof DataView)return new V(e);if(T&&e instanceof Blob)return Z(e,t,"blob",J);throw U("Invalid input argument")}(e,t.options),(function(e){t.file=e}))}catch(e){return Promise.reject(e)}}},{key:"parse",value:function(){try{var e=this;return e.setup(),Te(e.fileParser.parse(),(function(){var t,n={},r=[],i=p(e.parsers).map((t=function(t){var i;return Oe((function(){return e.options.silentErrors?(n=function(e,t){try{var n=e()}catch(e){return t(e)}return n&&n.then?n.then(void 0,t):n}((function(){return Te(t.parse(),(function(e){i=e}))}),(function(e){r.push(e)})),a=function(){t.errors.length&&r.push.apply(r,t.errors)},n&&n.then?n.then(a):a(n)):Te(t.parse(),(function(e){i=e}));var n,a}),(function(){t.assignToOutput(n,i)}))},function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];try{return Promise.resolve(t.apply(this,e))}catch(e){return Promise.reject(e)}}));return Te(Promise.all(i),(function(){return e.options.silentErrors&&r.length>0&&(n.errors=r),n=M(n),e.file.close&&e.file.close(),n}))}))}catch(e){return Promise.reject(e)}}},{key:"extractThumbnail",value:function(){try{var e=this;e.setup();var t,n=_.get("tiff",e.options);return Oe((function(){if(!e.file.isTiff)return function(e){var t=e();if(t&&t.then)return t.then(De)}((function(){if(e.file.isJpeg)return Te(e.fileParser.getOrFindSegment("tiff"),(function(e){t=e}))}));t={start:0,type:"tiff"}}),(function(){if(void 0!==t)return Te(e.fileParser.ensureSegmentChunk(t),(function(t){return Te((e.parsers.tiff=new n(t,e.options,e.file)).extractThumbnail(),(function(t){return e.file.close&&e.file.close(),t}))}))}))}catch(e){return Promise.reject(e)}}}]),e}();function xe(e,t,n){return n?t?t(e):e:(e&&e.then||(e=Promise.resolve(e)),t?e.then(t):e)}function Re(e){return function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];try{return Promise.resolve(e.apply(this,t))}catch(e){return Promise.reject(e)}}}var Me=Re((function(e){var t=new we(Ae);return xe(t.read(e),(function(){return xe(t.parse(),(function(e){if(e&&e.ifd0)return e.ifd0[274]}))}))})),Le=Re((function(e){var t=new we(Pe);return xe(t.read(e),(function(){return xe(t.parse(),(function(e){if(e&&e.gps){var t=e.gps;return{latitude:t.latitude,longitude:t.longitude}}}))}))})),Fe=Re((function(e){return xe(this.thumbnail(e),(function(e){if(void 0!==e){var t=new Blob([e]);return URL.createObjectURL(t)}}))})),Ue=Re((function(e){var t=new we(Ie);return xe(t.read(e),(function(){return xe(t.extractThumbnail(),(function(e){return e&&R?w.from(e):e}))}))})),Be=Re((function(e,t){var n=new we(t);return xe(n.read(e),(function(){return n.parse()}))})),Ee=Object.freeze({__proto__:null,orientation:Me,gps:Le,thumbnailUrl:Fe,thumbnail:Ue,parse:Be,Exifr:we,fileParsers:H,segmentParsers:_,fileReaders:W,tagKeys:re,tagValues:ie,tagRevivers:ae,createDictionary:te,extendDictionary:ne,fetchUrlAsArrayBuffer:Y,readBlobAsArrayBuffer:J,chunkedProps:oe,otherSegments:se,segments:ue,tiffBlocks:fe,segmentsAndBlocks:le,tiffExtractables:ce,inheritables:he,allFormatters:de,Options:me,disableAllOptions:be,gpsOnlyOptions:Pe,orientationOnlyOptions:Ae,thumbnailOnlyOptions:Ie});function Ne(){}var Ge=function(e){function n(){var e,r;t(this,n);for(var a=arguments.length,s=new Array(a),u=0;u<a;u++)s[u]=arguments[u];return i(c(r=h(this,(e=o(n)).call.apply(e,[this].concat(s)))),"ranges",new Ve),0!==r.byteLength&&r.ranges.add(0,r.byteLength),r}return a(n,e),r(n,[{key:"_tryExtend",value:function(e,t,n){if(0===e&&0===this.byteLength&&n){var r=new DataView(n.buffer||n,n.byteOffset,n.byteLength);this._swapDataView(r)}else{var i=e+t;if(i>this.byteLength){var a=this._extend(i).dataView;this._swapDataView(a)}}}},{key:"_extend",value:function(e){var t;t=R?w.allocUnsafe(e):new Uint8Array(e);var n=new DataView(t.buffer,t.byteOffset,t.byteLength);return t.set(new Uint8Array(this.buffer,this.byteOffset,this.byteLength),0),{uintView:t,dataView:n}}},{key:"subarray",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return t=t||this._lengthToEnd(e),r&&this._tryExtend(e,t),this.ranges.add(e,t),d(o(n.prototype),"subarray",this).call(this,e,t)}},{key:"set",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];r&&this._tryExtend(t,e.byteLength,e);var i=d(o(n.prototype),"set",this).call(this,e,t);return this.ranges.add(t,i.byteLength),i}},{key:"ensureChunk",value:function(e,t){try{if(!this.chunked)return;if(this.ranges.available(e,t))return;return function(e,t){if(!t)return e&&e.then?e.then(Ne):Promise.resolve()}(this.readChunk(e,t))}catch(e){return Promise.reject(e)}}},{key:"available",value:function(e,t){return this.ranges.available(e,t)}}]),n}(V),Ve=function(){function e(){t(this,e),i(this,"list",[])}return r(e,[{key:"add",value:function(e,t){var n=e+t,r=this.list.filter((function(t){return je(e,t.offset,n)||je(e,t.end,n)}));if(r.length>0){e=Math.min.apply(Math,[e].concat(r.map((function(e){return e.offset})))),t=(n=Math.max.apply(Math,[n].concat(r.map((function(e){return e.end})))))-e;var i=r.shift();i.offset=e,i.length=t,i.end=n,this.list=this.list.filter((function(e){return!r.includes(e)}))}else this.list.push({offset:e,length:t,end:n})}},{key:"available",value:function(e,t){var n=e+t;return this.list.some((function(t){return t.offset<=e&&n<=t.end}))}},{key:"length",get:function(){return this.list.length}}]),e}();function je(e,t,n){return e<=t&&t<=n}function ze(){}function He(e,t){if(!t)return e&&e.then?e.then(ze):Promise.resolve()}var _e=function(e){function n(e,r){var a;return t(this,n),i(c(a=h(this,o(n).call(this,0))),"chunksRead",0),a.input=e,a.options=r,a}return a(n,e),r(n,[{key:"readWhole",value:function(){try{return this.chunked=!1,He(this.readChunk(this.nextChunkOffset))}catch(e){return Promise.reject(e)}}},{key:"readChunked",value:function(){try{return this.chunked=!0,He(this.readChunk(0,this.options.firstChunkSize))}catch(e){return Promise.reject(e)}}},{key:"readNextChunk",value:function(e){try{if(void 0===e&&(e=this.nextChunkOffset),this.fullyRead)return this.chunksRead++,!1;var t=this.options.chunkSize;return n=this.readChunk(e,t),r=function(e){return!!e&&e.byteLength===t},i?r?r(n):n:(n&&n.then||(n=Promise.resolve(n)),r?n.then(r):n)}catch(e){return Promise.reject(e)}var n,r,i}},{key:"readChunk",value:function(e,t){try{if(this.chunksRead++,0===(t=this.safeWrapAddress(e,t)))return;return this._readChunk(e,t)}catch(e){return Promise.reject(e)}}},{key:"safeWrapAddress",value:function(e,t){return void 0!==this.size&&e+t>this.size?Math.max(0,this.size-e):t}},{key:"read",value:function(){return this.options.chunked?this.readChunked():this.readWhole()}},{key:"close",value:function(){}},{key:"nextChunkOffset",get:function(){if(0!==this.ranges.list.length)return this.ranges.list[0].length}},{key:"canReadNextChunk",get:function(){return this.chunksRead<this.options.chunkLimit}},{key:"fullyRead",get:function(){return void 0!==this.size&&this.nextChunkOffset===this.size}}]),n}(Ge);function We(e,t,n){return n?t?t(e):e:(e&&e.then||(e=Promise.resolve(e)),t?e.then(t):e)}var Ke=function(e){function n(){return t(this,n),h(this,o(n).apply(this,arguments))}return a(n,e),r(n,[{key:"readWhole",value:function(){try{var e=this;return e.chunked=!1,We(J(e.input),(function(t){e._swapArrayBuffer(t)}))}catch(e){return Promise.reject(e)}}},{key:"readChunked",value:function(){return this.chunked=!0,this.size=this.input.size,d(o(n.prototype),"readChunked",this).call(this)}},{key:"_readChunk",value:function(e,t){try{var n=this,r=t?e+t:void 0,i=n.input.slice(e,r);return We(J(i),(function(t){return n.set(t,e,!0)}))}catch(e){return Promise.reject(e)}}}]),n}(_e);W.set("blob",Ke);var Xe=function(){function e(n,r,a){var o,s=this;t(this,e),i(this,"ensureSegmentChunk",(o=function(e){var t,n,r,i=e.start,a=e.size||65536;return t=function(){if(s.file.chunked)return function(){if(!s.file.available(i,a))return function(e,t){try{var n=e()}catch(e){return t(e)}return n&&n.then?n.then(void 0,t):n}((function(){return t=s.file.readChunk(i,a),n=function(t){e.chunk=t},r?n?n(t):t:(t&&t.then||(t=Promise.resolve(t)),n?t.then(n):t);var t,n,r}),(function(t){throw U("Couldn't read segment: ".concat(JSON.stringify(e),". ").concat(t.message))}));e.chunk=s.file.subarray(i,a)}();if(s.file.byteLength>i+a)e.chunk=s.file.subarray(i,a);else{if(void 0!==e.size)throw U("Segment unreachable: "+JSON.stringify(e));e.chunk=s.file.subarray(i)}},n=function(t){return e.chunk},(r=t())&&r.then?r.then(n):n(r)},function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];try{return Promise.resolve(o.apply(this,e))}catch(e){return Promise.reject(e)}})),this.extendOptions&&this.extendOptions(n),this.options=n,this.file=r,this.parsers=a}return r(e,[{key:"createParser",value:function(e,t){var n=new(_.get(e))(t,this.options,this.file);return this.parsers[e]=n}}]),e}(),Je=function(){function e(n){var r=this,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=arguments.length>2?arguments[2]:void 0;t(this,e),i(this,"errors",[]),i(this,"raw",P()),i(this,"handleError",(function(e){if(!r.options.silentErrors)throw e;r.errors.push(e.message)})),this.chunk=this.normalizeInput(n),this.file=o,this.type=this.constructor.type,this.globalOptions=this.options=a,this.localOptions=a[this.type],this.canTranslate=this.localOptions&&this.localOptions.translate}return r(e,[{key:"normalizeInput",value:function(e){return e instanceof V?e:new V(e)}}],[{key:"findPosition",value:function(e,t){var n=e.getUint16(t+2)+2,r="function"==typeof this.headerLength?this.headerLength(e,t,n):this.headerLength,i=t+r,a=n-r;return{offset:t,length:n,headerLength:r,start:i,size:a,end:i+a}}},{key:"parse",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=new me(i({},this.type,t)),r=new this(e,n);return r.parse()}}]),r(e,[{key:"translate",value:function(){this.canTranslate&&(this.translated=this.translateBlock(this.raw,this.type))}},{key:"translateBlock",value:function(e,t){var n=ae.get(t),r=ie.get(t),i=re.get(t),a=this.options[t],o=a.reviveValues&&!!n,s=a.translateValues&&!!r,u=a.translateKeys&&!!i,f={},l=e;Array.isArray(l)||("function"==typeof l.entries&&(l=l.entries()),l=m(l));for(var c=0;c<l.length;c++){var h=l[c],d=h[0],p=h[1];o&&n.has(d)?p=n.get(d)(p):s&&r.has(d)&&(p=this.translateValue(p,r.get(d))),u&&i.has(d)&&(d=i.get(d)||d),f[d]=p}return f}},{key:"translateValue",value:function(e,t){return t[e]||e}},{key:"assignToOutput",value:function(e,t){this.assignObjectToOutput(e,this.constructor.type,t)}},{key:"assignObjectToOutput",value:function(e,t,n){if(this.globalOptions.mergeOutput)return v(e,n);e[t]?v(e[t],n):e[t]=n}},{key:"output",get:function(){return this.translated?this.translated:this.raw?y(this.raw):void 0}}]),e}();function Ye(e,t,n){return n?t?t(e):e:(e&&e.then||(e=Promise.resolve(e)),t?e.then(t):e)}i(Je,"headerLength",4),i(Je,"type",void 0),i(Je,"multiSegment",!1),i(Je,"canHandle",(function(){return!1}));function qe(){}function Qe(e,t){if(!t)return e&&e.then?e.then(qe):Promise.resolve()}function Ze(e){var t=e();if(t&&t.then)return t.then(qe)}function $e(e,t){var n=e();return n&&n.then?n.then(t):t(n)}function et(e,t,n){if(!e.s){if(n instanceof tt){if(!n.s)return void(n.o=et.bind(null,e,t));1&t&&(t=n.s),n=n.v}if(n&&n.then)return void n.then(et.bind(null,e,t),et.bind(null,e,2));e.s=t,e.v=n;var r=e.o;r&&r(e)}}var tt=function(){function e(){}return e.prototype.then=function(t,n){var r=new e,i=this.s;if(i){var a=1&i?t:n;if(a){try{et(r,1,a(this.v))}catch(e){et(r,2,e)}return r}return this}return this.o=function(e){try{var i=e.v;1&e.s?et(r,1,t?t(i):i):n?et(r,1,n(i)):et(r,2,i)}catch(e){et(r,2,e)}},r},e}();function nt(e){return e instanceof tt&&1&e.s}function rt(e,t,n){for(var r;;){var i=e();if(nt(i)&&(i=i.v),!i)return a;if(i.then){r=0;break}var a=n();if(a&&a.then){if(!nt(a)){r=1;break}a=a.s}if(t){var o=t();if(o&&o.then&&!nt(o)){r=2;break}}}var s=new tt,u=et.bind(null,s,2);return(0===r?i.then(l):1===r?a.then(f):o.then(c)).then(void 0,u),s;function f(r){a=r;do{if(t&&(o=t())&&o.then&&!nt(o))return void o.then(c).then(void 0,u);if(!(i=e())||nt(i)&&!i.v)return void et(s,1,a);if(i.then)return void i.then(l).then(void 0,u);nt(a=n())&&(a=a.v)}while(!a||!a.then);a.then(f).then(void 0,u)}function l(e){e?(a=n())&&a.then?a.then(f).then(void 0,u):f(a):et(s,1,a)}function c(){(i=e())?i.then?i.then(l).then(void 0,u):l(i):et(s,1,a)}}function it(e){return 192===e||194===e||196===e||219===e||221===e||218===e||254===e}function at(e){return e>=224&&e<=239}function ot(e,t){var n=_;Array.isArray(n)||("function"==typeof n.entries&&(n=n.entries()),n=m(n));for(var r=0;r<n.length;r++){var i=n[r],a=i[0];if(i[1].canHandle(e,t))return a}}var st=function(e){function n(){var e,r;t(this,n);for(var a=arguments.length,s=new Array(a),u=0;u<a;u++)s[u]=arguments[u];return i(c(r=h(this,(e=o(n)).call.apply(e,[this].concat(s)))),"appSegments",[]),i(c(r),"jpegSegments",[]),i(c(r),"unknownSegments",[]),r}return a(n,e),r(n,[{key:"parse",value:function(){try{var e=this;return Ye(e.findAppSegments(),(function(){return Ye(e.readSegments(),(function(){e.mergeMultiSegments(),e.createParsers()}))}))}catch(e){return Promise.reject(e)}}},{key:"readSegments",value:function(){try{var e=this.appSegments.map(this.ensureSegmentChunk);return Qe(Promise.all(e))}catch(e){return Promise.reject(e)}}},{key:"setupSegmentFinderArgs",value:function(e){var t=this;!0===e?(this.findAll=!0,this.wanted=b(_.keyList())):(e=void 0===e?_.keyList().filter((function(e){return t.options[e].enabled})):e.filter((function(e){return t.options[e].enabled&&_.has(e)})),this.findAll=!1,this.remaining=b(e),this.wanted=b(e)),this.unfinishedMultiSegment=!1}},{key:"findAppSegments",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1?arguments[1]:void 0;try{var n=this;n.setupSegmentFinderArgs(t);var r=n.file,i=n.findAll,a=n.wanted,o=n.remaining;return $e((function(){if(!i&&n.file.chunked)return i=m(a).some((function(e){var t=_.get(e),r=n.options[e];return t.multiSegment&&r.multiSegment})),Ze((function(){if(i)return Qe(n.file.readWhole())}))}),(function(){var t=!1;if(e=n._findAppSegments(e,r.byteLength,i,a,o),!n.options.onlyTiff)return function(){if(r.chunked){var i=!1;return rt((function(){return!t&&o.size>0&&!i&&(!!r.canReadNextChunk||!!n.unfinishedMultiSegment)}),void 0,(function(){var a=r.nextChunkOffset,o=n.appSegments.some((function(e){return!n.file.available(e.offset||e.start,e.length||e.size)}));return $e((function(){return e>a&&!o?Ye(r.readNextChunk(e),(function(e){i=!e})):Ye(r.readNextChunk(a),(function(e){i=!e}))}),(function(){void 0===(e=n._findAppSegments(e,r.byteLength))&&(t=!0)}))}))}}()}))}catch(e){return Promise.reject(e)}}},{key:"_findAppSegments",value:function(e,t){for(var n,r,i,a,o,s,u=this.file,f=this.findAll,l=this.wanted,c=this.remaining,h=this.options;e<t;e++)if(255===u.getUint8(e))if(at(n=u.getUint8(e+1))){if(r=u.getUint16(e+2),(i=ot(u,e))&&l.has(i)&&(o=(a=_.get(i)).findPosition(u,e),s=h[i],o.type=i,this.appSegments.push(o),!f&&(a.multiSegment&&s.multiSegment?(this.unfinishedMultiSegment=o.chunkNumber<o.chunkCount,this.unfinishedMultiSegment||c.delete(i)):c.delete(i),0===c.size)))break;h.recordUnknownSegments&&((o=Je.findPosition(u,e)).marker=n,this.unknownSegments.push(o)),e+=r+1}else if(it(n)){if(r=u.getUint16(e+2),218===n&&!1!==h.stopAfterSos)return;h.recordJpegSegments&&this.jpegSegments.push({offset:e,length:r,marker:n}),e+=r+1}return e}},{key:"mergeMultiSegments",value:function(){var e=this;if(this.appSegments.some((function(e){return e.multiSegment}))){var t=function(e,t){for(var n,r,i,a=P(),o=0;o<e.length;o++)n=e[o],r=n[t],a.has(r)?i=a.get(r):a.set(r,i=[]),i.push(n);return m(a)}(this.appSegments,"type");this.mergedAppSegments=t.map((function(t){var n=t[0],r=t[1],i=_.get(n,e.options);return i.handleMultiSegments?{type:n,chunk:i.handleMultiSegments(r)}:r[0]}))}}},{key:"createParsers",value:function(){try{var e=this.mergedAppSegments||this.appSegments;Array.isArray(e)||("function"==typeof e.entries&&(e=e.entries()),e=m(e));for(var t=0;t<e.length;t++){var n=e[t],r=n.type,i=n.chunk;if(this.options[r].enabled){var a=this.parsers[r];if(a&&a.append);else if(!a){var o=new(_.get(r,this.options))(i,this.options,this.file);this.parsers[r]=o}}}return Ye()}catch(e){return Promise.reject(e)}}},{key:"getSegment",value:function(e){return this.appSegments.find((function(t){return t.type===e}))}},{key:"getOrFindSegment",value:function(e){try{var t=this,n=t.getSegment(e);return $e((function(){if(void 0===n)return Ye(t.findAppSegments(0,[e]),(function(){n=t.getSegment(e)}))}),(function(){return n}))}catch(e){return Promise.reject(e)}}}]),n}(Xe);function ut(){}H.set("jpeg",st);function ft(e,t){if(!t)return e&&e.then?e.then(ut):Promise.resolve()}function lt(e,t){var n=e();return n&&n.then?n.then(t):t(n)}var ct=[void 0,1,1,2,4,8,1,1,2,4,8,4,8,4];var ht=function(e){function n(){return t(this,n),h(this,o(n).apply(this,arguments))}return a(n,e),r(n,[{key:"parse",value:function(){try{var e=this;return e.parseHeader(),lt((function(){if(e.options.ifd0.enabled)return ft(e.parseIfd0Block())}),(function(){return lt((function(){if(e.options.exif.enabled)return ft(e.saveParseBlock("parseExifBlock"))}),(function(){return lt((function(){if(e.options.gps.enabled)return ft(e.saveParseBlock("parseGpsBlock"))}),(function(){return lt((function(){if(e.options.interop.enabled)return ft(e.saveParseBlock("parseInteropBlock"))}),(function(){return lt((function(){if(e.options.ifd1.enabled)return ft(e.saveParseBlock("parseThumbnailBlock"))}),(function(){return e.createOutput()}))}))}))}))}))}catch(e){return Promise.reject(e)}}},{key:"saveParseBlock",value:function(e){try{var t=this;return function(e,t){try{var n=e()}catch(e){return t(e)}return n&&n.then?n.then(void 0,t):n}((function(){return n=t[e](),i?r?r(n):n:(n&&n.then||(n=Promise.resolve(n)),r?n.then(r):n);var n,r,i}),(function(e){t.handleError(e)}))}catch(e){return Promise.reject(e)}}},{key:"findIfd0Offset",value:function(){void 0===this.ifd0Offset&&(this.ifd0Offset=this.chunk.getUint32(4))}},{key:"findIfd1Offset",value:function(){if(void 0===this.ifd1Offset){this.findIfd0Offset();var e=this.chunk.getUint16(this.ifd0Offset),t=this.ifd0Offset+2+12*e;this.ifd1Offset=this.chunk.getUint32(t)}}},{key:"parseBlock",value:function(e,t){var n=P();return this[t]=n,this.parseTags(e,t,n),n}},{key:"parseIfd0Block"